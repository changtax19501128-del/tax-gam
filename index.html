import React, { useState, useEffect } from 'react';
import { Trophy, Flag, CheckCircle, XCircle, RotateCcw, Sparkles, Facebook, Youtube, Instagram, Clock } from 'lucide-react';

const TaxQuizGame = () => {
  const questions = [
    {
      question: "房屋稅每年幾月開始繳納？",
      options: ["3月", "5月", "7月", "9月"],
      correct: 1,
      explanation: "房屋稅每年5月開始繳納，繳納期間通常是5月1日到5月31日。這是台灣的固定稅收時程，房屋所有人要記得按時繳納喔！"
    },
    {
      question: "牌照稅是對什麼東西課稅的？",
      options: ["房子", "汽車機車", "土地", "商店"],
      correct: 1,
      explanation: "牌照稅是針對汽車、機車等車輛課徵的稅，目的是要車主為使用道路付費。每年都要繳納，讓政府可以維護道路設施。"
    },
    {
      question: "雲端發票可以幫我們做什麼？",
      options: ["自動對獎", "環保減紙", "記錄消費", "以上都對"],
      correct: 3,
      explanation: "雲端發票真的很棒！它可以自動幫我們對獎，不用擔心發票遺失；減少紙張使用更環保；還能自動記錄我們的消費，一舉多得！"
    },
    {
      question: "地價稅是每年什麼時候繳納？",
      options: ["5月", "7月", "9月", "11月"],
      correct: 3,
      explanation: "地價稅每年11月開始繳納，通常繳納期間是11月1日到11月30日。這是針對土地所有人課徵的稅，按土地的公告地價計算。"
    },
    {
      question: "納保官是做什麼的？",
      options: ["保護納稅人權益", "收稅", "賣保險", "開罰單"],
      correct: 0,
      explanation: "納保官全名是「納稅者權利保護官」，專門保護納稅人的權益！如果你覺得稅務機關的處分不公平，可以向納保官申請協助。"
    },
    {
      question: "小彰在彰化縣有3棟房子，請問她在5月會收到幾張房屋稅稅單？",
      options: ["1張", "2張", "3張", "4張"],
      correct: 2,
      explanation: "每棟房屋都會開立一張稅單，所以小彰有3棟房子就會收到3張房屋稅稅單。每張稅單對應一棟房屋，這樣才能清楚知道每棟房屋的稅額。"
    },
    {
      question: "使用雲端發票的好處是什麼？",
      options: ["可以省紙張", "不會弄丟發票", "自動存起來", "以上都對"],
      correct: 3,
      explanation: "雲端發票的好處超多！省紙張愛地球、不會弄丟發票、自動儲存在雲端、自動對獎、還能追蹤消費記錄，真的很方便！"
    },
    {
      question: "車主可就同一縣（市）內全部車輛申請使用牌照稅稅單歸戶，每張稅單最多可以歸戶幾輛？",
      options: ["3輛", "4輛", "5輛", "6輛"],
      correct: 2,
      explanation: "現行車主如名下有5輛車，每年須拿5張稅單去繳納，申請歸戶後，只須拿1張繳款書就可完成繳納，方便又環保。"
    },
    {
      question: "房屋稅新制自113年7月1日起實施，增訂自住房屋需本人、配偶或直系親屬辦竣戶籍登記，才適用自住住家用優惠稅率，對不對？",
      options: ["對", "不對", "不確定", "沒規定"],
      correct: 0,
      explanation: "房屋稅新制確實規定自住房屋需要本人、配偶或直系親屬辦竣戶籍登記，才能適用自住住家用的優惠稅率。這是為了確保真正自住使用。"
    },
    {
      question: "申請地價稅自用住宅用地優惠稅率，應於每年幾月幾日前提出申請，當年度才可適用？",
      options: ["8月31日", "9月22日", "10月15日", "11月1日"],
      correct: 1,
      explanation: "申請地價稅自用住宅用地優惠稅率，需要在每年9月22日前提出申請，當年度才可以適用優惠稅率。記得要提前申請喔！"
    },
    {
      question: "有設定中獎獎金自動匯款的載具，雲端發票中獎了會怎麼樣？",
      options: ["要自己去領", "會自動匯入帳戶", "會寄通知單", "不會中獎"],
      correct: 1,
      explanation: "雲端發票中獎最棒的地方就是會自動匯入你設定的帳戶！不用擔心忘記領獎或發票過期，系統會自動幫你處理，超方便的！"
    },
    {
      question: "納保官可以幫納稅人做什麼？",
      options: ["代繳稅款", "申請分期繳納", "維護權益", "減免稅額"],
      correct: 2,
      explanation: "納保官主要是維護納稅人的權益，協助處理稅務爭議。雖然不能直接代繳稅款或減免稅額，但可以協助你了解權利、申訴程序等。"
    },
    {
      question: "下列何者符合性別平等觀念？",
      options: ["男生負責工作", "女生負責家事", "家務不分男生和女生，應該共同負擔", "男女生有不同分工"],
      correct: 2,
      explanation: "性別平等的觀念是不論男生女生，都應該共同負擔家務和工作責任。每個人都有平等的權利和義務，不應該因為性別而有差別待遇。"
    },
    {
      question: "房屋稅新制自113年7月1日起實施，並改按「年」計徵，以每年幾月末日為納稅義務基準日？",
      options: ["1月", "2月", "3月", "4月"],
      correct: 1,
      explanation: "房屋稅新制改按年計徵後，以每年2月末日為納稅義務基準日。這表示房屋的使用情況和稅率適用，都以2月底的狀況為準。"
    },
    {
      question: "如果你有地方稅問題，可向哪一個機關詢問？",
      options: ["警察局", "地方稅務局", "區公所", "郵局"],
      correct: 1,
      explanation: "有地方稅問題當然要找地方稅務局！他們是專門處理房屋稅、地價稅、牌照稅等地方稅務的專業機關，可以提供最正確的資訊和服務。"
    }
  ];

  const [currentQuestions, setCurrentQuestions] = useState([]);
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [showResult, setShowResult] = useState(false);
  const [flags, setFlags] = useState([]);
  const [gameFinished, setGameFinished] = useState(false);
  const [gameStarted, setGameStarted] = useState(false);
  const [startTime, setStartTime] = useState(null);
  const [endTime, setEndTime] = useState(null);

  // 隨機選擇題目
  useEffect(() => {
    const shuffled = [...questions].sort(() => Math.random() - 0.5);
    setCurrentQuestions(shuffled);
  }, []);

  const currentQuestion = currentQuestions[currentQuestionIndex];
  const flagCount = flags.length;
  const targetFlags = 3;

  const handleAnswerSelect = (answerIndex) => {
    if (showResult) return;
    setSelectedAnswer(answerIndex);
  };

  const handleSubmit = () => {
    if (selectedAnswer === null) return;
    
    setShowResult(true);
    const isCorrect = selectedAnswer === currentQuestion.correct;
    
    if (isCorrect) {
      const newFlags = [...flags, { id: Date.now(), correct: true }];
      setFlags(newFlags);
      
      // 如果獲得3面國旗就結束遊戲
      if (newFlags.length >= targetFlags) {
        setEndTime(Date.now());
        setTimeout(() => setGameFinished(true), 1500);
      }
    }
  };

  const nextQuestion = () => {
    if (flagCount >= targetFlags) {
      setEndTime(Date.now());
      setGameFinished(true);
      return;
    }

    if (currentQuestionIndex < currentQuestions.length - 1) {
      setCurrentQuestionIndex(currentQuestionIndex + 1);
      setSelectedAnswer(null);
      setShowResult(false);
    } else {
      setEndTime(Date.now());
      setGameFinished(true);
    }
  };

  const resetGame = () => {
    const shuffled = [...questions].sort(() => Math.random() - 0.5);
    setCurrentQuestions(shuffled);
    setCurrentQuestionIndex(0);
    setSelectedAnswer(null);
    setShowResult(false);
    setFlags([]);
    setGameFinished(false);
    setGameStarted(false);
    setStartTime(null);
    setEndTime(null);
  };

  const startGame = () => {
    setGameStarted(true);
    setStartTime(Date.now());
  };

  // 計算遊戲時間
  const getGameTime = () => {
    if (!startTime || !endTime) return "0秒";
    const timeDiff = Math.floor((endTime - startTime) / 1000);
    const minutes = Math.floor(timeDiff / 60);
    const seconds = timeDiff % 60;
    return minutes > 0 ? `${minutes}分${seconds}秒` : `${seconds}秒`;
  };

  if (currentQuestions.length === 0) {
    return (
      <div className="min-h-screen flex items-center justify-center" style={{
        backgroundImage: 'url("data:image/svg+xml,%3Csvg width="1242" height="828" viewBox="0 0 1242 828" fill="none" xmlns="http://www.w3.org/2000/svg"%3E%3Crect width="1242" height="828" fill="%23F5E6D3"/%3E%3Crect x="100" y="92" width="1042" height="644" rx="20" fill="%23E85A4F"/%3E%3Crect x="100" y="92" width="568" height="356" fill="%23547D8C"/%3E%3Cg transform="translate(384,270)"%3E%3Ccircle cx="0" cy="0" r="60" fill="%23F5E6D3"/%3E%3Cpath d="M0,-80 L15,-25 L0,-35 L-15,-25 Z M0,-80 L25,-15 L35,0 L25,15 Z M0,-80 L15,25 L0,35 L-15,25 Z M0,-80 L-25,15 L-35,0 L-25,-15 Z" fill="%23F5E6D3"/%3E%3Cpath d="M0,80 L-15,25 L0,35 L15,25 Z M0,80 L-25,15 L-35,0 L-25,-15 Z M0,80 L-15,-25 L0,-35 L15,-25 Z M0,80 L25,-15 L35,0 L25,15 Z" fill="%23F5E6D3"/%3E%3Cpath d="M80,0 L25,15 L35,0 L25,-15 Z M80,0 L15,25 L0,35 L-15,25 Z M80,0 L-25,15 L-35,0 L-25,-15 Z M80,0 L-15,-25 L0,-35 L15,-25 Z" fill="%23F5E6D3"/%3E%3Cpath d="M-80,0 L-25,-15 L-35,0 L-25,15 Z M-80,0 L-15,-25 L0,-35 L15,-25 Z M-80,0 L25,-15 L35,0 L25,15 Z M-80,0 L15,25 L0,35 L-15,25 Z" fill="%23F5E6D3"/%3E%3C/g%3E%3C/svg%3E")',
        backgroundSize: 'cover',
        backgroundPosition: 'center',
        backgroundRepeat: 'no-repeat'
      }}>
        <div className="text-center">
          <div className="text-2xl font-bold text-red-600 mb-4">載入中...</div>
          <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-red-500 mx-auto"></div>
        </div>
      </div>
    );
  }

  // 遊戲開始前的說明畫面
  if (!gameStarted) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-red-50 via-white to-blue-50 flex items-center justify-center p-4">
        <div className="bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-8 max-w-2xl w-full text-center border border-red-100 relative">
          {/* 標題區 */}
          <div className="flex justify-center gap-4 mb-6">
            <Sparkles className="w-12 h-12 text-red-400 animate-pulse" />
            <Trophy className="w-16 h-16 text-red-500" />
            <Sparkles className="w-12 h-12 text-blue-400 animate-pulse" />
          </div>
          
          <h1 className="text-4xl font-bold text-red-600 mb-2">
            🎊 國慶稅務小達人 🎊
          </h1>
          <p className="text-lg text-blue-600 mb-8 flex items-center justify-center gap-2">
            <Flag className="w-5 h-5" />
            歡迎來到稅務知識挑戰！
            <Sparkles className="w-5 h-5 text-yellow-400" />
          </p>
          
          {/* 遊戲玩法說明 */}
          <div className="bg-gradient-to-r from-red-50 to-blue-50 rounded-2xl p-6 mb-8 border border-red-100">
            <h2 className="text-2xl font-bold text-red-700 mb-4 flex items-center justify-center gap-2">
              <Flag className="w-6 h-6" />
              遊戲玩法
            </h2>
            
            <div className="text-left space-y-4 text-gray-700">
              <div className="flex items-start gap-3">
                <div className="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center font-bold text-red-600 flex-shrink-0 mt-1">
                  1
                </div>
                <div>
                  <div className="font-semibold text-red-700">答題挑戰</div>
                  <div>回答稅務相關問題，包含房屋稅、牌照稅、雲端發票等知識</div>
                </div>
              </div>
              
              <div className="flex items-start gap-3">
                <div className="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center font-bold text-red-600 flex-shrink-0 mt-1">
                  2
                </div>
                <div>
                  <div className="font-semibold text-red-700">收集國旗</div>
                  <div>每答對一題就能獲得一面國旗 🚩</div>
                </div>
              </div>
              
              <div className="flex items-start gap-3">
                <div className="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center font-bold text-red-600 flex-shrink-0 mt-1">
                  3
                </div>
                <div>
                  <div className="font-semibold text-red-700">挑戰目標</div>
                  <div>收集到 <span className="font-bold text-red-600">3面國旗</span> 就完成挑戰！🏆</div>
                </div>
              </div>
              
              <div className="flex items-start gap-3">
                <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center font-bold text-blue-600 flex-shrink-0 mt-1">
                  💡
                </div>
                <div>
                  <div className="font-semibold text-blue-700">小提示</div>
                  <div>題目都很簡單喔！仔細想想日常生活中的稅務知識</div>
                </div>
              </div>
            </div>
          </div>
          
          {/* 開始按鈕 */}
          <button
            onClick={startGame}
            className="bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white font-bold py-4 px-12 rounded-full text-xl transition-all duration-300 transform hover:scale-105 shadow-lg border border-red-300 flex items-center gap-3 mx-auto"
          >
            <Flag className="w-6 h-6" />
            開始挑戰
            <Sparkles className="w-6 h-6" />
          </button>
          
          <p className="text-sm text-gray-500 mt-4">
            準備好了嗎？讓我們一起學習稅務知識！
          </p>
        </div>
      </div>
    );
  }

  if (gameFinished) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-red-50 via-white to-blue-50 flex items-center justify-center p-4 relative">
        <div className="bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-8 max-w-2xl w-full text-center border border-red-100">
          {/* 煙火效果 */}
          <div className="flex justify-center gap-4 mb-6">
            <Sparkles className="w-12 h-12 text-red-400 animate-pulse" />
            <Trophy className="w-16 h-16 text-red-500" />
            <Sparkles className="w-12 h-12 text-blue-400 animate-pulse" />
          </div>
          
          <h1 className="text-4xl font-bold text-red-600 mb-4">
            🎉 恭喜完成挑戰！🎉
          </h1>
          
          {/* 通關時間顯示 */}
          <div className="mb-4 bg-gradient-to-r from-yellow-100 to-yellow-200 rounded-2xl p-4 border border-yellow-300">
            <div className="flex items-center justify-center gap-2 text-yellow-800">
              <Clock className="w-5 h-5" />
              <span className="font-bold text-lg">通關時間: {getGameTime()}</span>
            </div>
          </div>
          
          {flagCount >= targetFlags ? (
            <div className="mb-6">
              <h3 className="text-2xl font-semibold text-red-700 mb-3">🏆 挑戰成功！</h3>
              <p className="text-lg text-gray-700">你已經收集到 {targetFlags} 面國旗了！</p>
            </div>
          ) : (
            <div className="mb-6">
              <h3 className="text-xl font-semibold text-blue-600 mb-3">繼續加油！</h3>
              <p className="text-lg text-gray-700">你收集到了 {flagCount} 面國旗</p>
            </div>
          )}
          
          {/* 顯示獲得的國旗 */}
          <div className="mb-8">
            <div className="flex justify-center gap-3 mb-4">
              {Array.from({ length: targetFlags }).map((_, index) => (
                <div key={index} className="relative">
                  <Flag 
                    className={`w-12 h-12 ${
                      index < flagCount ? 'text-red-500' : 'text-gray-300'
                    }`} 
                  />
                  {index < flagCount && (
                    <Sparkles className="w-4 h-4 text-yellow-400 absolute -top-1 -right-1 animate-bounce" />
                  )}
                </div>
              ))}
            </div>
            <div className="text-lg font-bold text-red-600">
              國旗收集進度: {flagCount}/{targetFlags}
            </div>
          </div>
          
          <button
            onClick={resetGame}
            className="bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white font-bold py-3 px-8 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center gap-2 mx-auto border border-red-300"
          >
            <RotateCcw className="w-5 h-5" />
            再玩一次
          </button>
          
          {/* 兌換狀態顯示 */}
          {isRedeemed && (
            <div className="mt-6 bg-green-100 border border-green-400 rounded-2xl p-4">
              <div className="flex items-center justify-center gap-2 text-green-700">
                <CheckCircle className="w-6 h-6" />
                <span className="font-bold text-lg">✅ 已兌換獎品</span>
              </div>
            </div>
          )}
          
          {/* 工作人員輸入區 */}
          {!isRedeemed && (
            <div className="mt-6 text-center">
              {!showStaffInput ? (
                <>
                  <button
                    onClick={() => setShowStaffInput(true)}
                    className="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-6 rounded-lg transition-colors duration-200"
                  >
                    獎品兌換
                  </button>
                  <p className="text-xs text-gray-500 mt-2">工作人員輸入</p>
                </>
              ) : (
                <div className="bg-gray-50 rounded-2xl p-4 border border-gray-200">
                  <input
                    type="password"
                    value={staffCode}
                    onChange={(e) => setStaffCode(e.target.value)}
                    placeholder="請輸入驗證碼"
                    className="w-32 p-2 border border-gray-300 rounded-lg text-center font-mono"
                    maxLength="3"
                  />
                  <div className="flex gap-2 justify-center mt-3">
                    <button
                      onClick={handleStaffInput}
                      className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium"
                    >
                      確認
                    </button>
                    <button
                      onClick={() => {
                        setShowStaffInput(false);
                        setStaffCode('');
                      }}
                      className="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg font-medium"
                    >
                      取消
                    </button>
                  </div>
                </div>
              )}
            </div>
          )}
          
          {/* FB、IG、YT 連結 - 右下角 */}
          <div className="absolute bottom-6 right-6 flex flex-col gap-2">
            <a 
              href="https://www.facebook.com/ChangTax" 
              target="_blank" 
              rel="noopener noreferrer"
              className="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 group"
              title="Facebook 粉絲團"
            >
              <Facebook className="w-5 h-5" />
            </a>
            <a 
              href="https://www.youtube.com/channel/UCyixdD80Dk9LsjB2pr5aHtg" 
              target="_blank" 
              rel="noopener noreferrer"
              className="bg-red-600 hover:bg-red-700 text-white p-2 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 group"
              title="YouTube 頻道"
            >
              <Youtube className="w-5 h-5" />
            </a>
            <a 
              href="https://www.instagram.com/changtax_/" 
              target="_blank" 
              rel="noopener noreferrer"
              className="bg-pink-600 hover:bg-pink-700 text-white p-2 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 group"
              title="Instagram"
            >
              <Instagram className="w-5 h-5" />
            </a>
          </div>
        </div>
        
        {/* 左下角署名 - 只在通關時顯示 */}
        <div className="absolute bottom-6 left-6 text-black font-bold text-lg">
          彰化縣地方稅務局
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen p-4" style={{
      backgroundImage: 'url("data:image/svg+xml,%3Csvg width="1242" height="828" viewBox="0 0 1242 828" fill="none" xmlns="http://www.w3.org/2000/svg"%3E%3Crect width="1242" height="828" fill="%23F5E6D3"/%3E%3Crect x="100" y="92" width="1042" height="644" rx="20" fill="%23E85A4F"/%3E%3Crect x="100" y="92" width="568" height="356" fill="%23547D8C"/%3E%3Cg transform="translate(384,270)"%3E%3Ccircle cx="0" cy="0" r="60" fill="%23F5E6D3"/%3E%3Cpath d="M0,-80 L15,-25 L0,-35 L-15,-25 Z M0,-80 L25,-15 L35,0 L25,15 Z M0,-80 L15,25 L0,35 L-15,25 Z M0,-80 L-25,15 L-35,0 L-25,-15 Z" fill="%23F5E6D3"/%3E%3Cpath d="M0,80 L-15,25 L0,35 L15,25 Z M0,80 L-25,15 L-35,0 L-25,-15 Z M0,80 L-15,-25 L0,-35 L15,-25 Z M0,80 L25,-15 L35,0 L25,15 Z" fill="%23F5E6D3"/%3E%3Cpath d="M80,0 L25,15 L35,0 L25,-15 Z M80,0 L15,25 L0,35 L-15,25 Z M80,0 L-25,15 L-35,0 L-25,-15 Z M80,0 L-15,-25 L0,-35 L15,-25 Z" fill="%23F5E6D3"/%3E%3Cpath d="M-80,0 L-25,-15 L-35,0 L-25,15 Z M-80,0 L-15,-25 L0,-35 L15,-25 Z M-80,0 L25,-15 L35,0 L25,15 Z M-80,0 L15,25 L0,35 L-15,25 Z" fill="%23F5E6D3"/%3E%3C/g%3E%3C/svg%3E")',
      backgroundSize: 'cover',
      backgroundPosition: 'center',
      backgroundRepeat: 'no-repeat'
    }}>
      <div className="max-w-4xl mx-auto relative">
        {/* 標題與統計資訊 */}
        <div className="bg-white/90 backdrop-blur-sm rounded-3xl shadow-xl p-6 mb-6 border border-red-100">
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-3">
              <Trophy className="w-8 h-8 text-red-500" />
              <h1 className="text-3xl font-bold text-red-600">
                🎊 國慶稅務小達人 🎊
              </h1>
            </div>
            
            {/* 右上角國旗統計 */}
            <div className="text-right">
              <div className="text-lg font-bold text-red-600 mb-2">
                國旗收集進度: {flagCount}/{targetFlags}
              </div>
              <div className="flex gap-1">
                {Array.from({ length: targetFlags }).map((_, index) => (
                  <Flag 
                    key={index}
                    className={`w-6 h-6 ${
                      index < flagCount ? 'text-red-500' : 'text-gray-300'
                    }`} 
                  />
                ))}
              </div>
            </div>
          </div>
        </div>

        {/* 題目卡片 */}
        <div className="bg-white/90 backdrop-blur-sm rounded-3xl shadow-xl p-8 border border-blue-100">
          <div className="mb-6">
            <div className="text-sm text-blue-600 mb-2 flex items-center gap-2">
              <Sparkles className="w-4 h-4" />
              第 {currentQuestionIndex + 1} 題
            </div>
            <div className="w-full bg-blue-100 rounded-full h-3">
              <div 
                className="bg-gradient-to-r from-red-400 to-blue-400 h-3 rounded-full transition-all duration-500"
                style={{ width: `${((currentQuestionIndex + 1) / currentQuestions.length) * 100}%` }}
              ></div>
            </div>
          </div>

          <h2 className="text-2xl font-bold text-red-700 mb-8">
            {currentQuestion?.question}
          </h2>

          <div className="space-y-4 mb-8">
            {currentQuestion?.options.map((option, index) => {
              let buttonClass = "w-full p-4 rounded-2xl border-2 transition-all duration-300 text-left font-medium";
              
              if (showResult) {
                if (index === currentQuestion.correct) {
                  buttonClass += " bg-green-50 border-green-400 text-green-700";
                } else if (index === selectedAnswer && index !== currentQuestion.correct) {
                  buttonClass += " bg-red-50 border-red-400 text-red-700";
                } else {
                  buttonClass += " bg-gray-50 border-gray-300 text-gray-600";
                }
              } else {
                if (selectedAnswer === index) {
                  buttonClass += " bg-red-50 border-red-400 text-red-700";
                } else {
                  buttonClass += " bg-white border-blue-200 text-blue-800 hover:bg-blue-50 hover:border-blue-300 cursor-pointer";
                }
              }

              return (
                <button
                  key={index}
                  onClick={() => handleAnswerSelect(index)}
                  className={buttonClass}
                >
                  <div className="flex items-center gap-3">
                    <div className="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center font-bold text-red-700">
                      {String.fromCharCode(65 + index)}
                    </div>
                    {option}
                    {showResult && index === currentQuestion.correct && (
                      <CheckCircle className="w-6 h-6 text-green-600 ml-auto" />
                    )}
                    {showResult && index === selectedAnswer && index !== currentQuestion.correct && (
                      <XCircle className="w-6 h-6 text-red-600 ml-auto" />
                    )}
                  </div>
                </button>
              );
            })}
          </div>

          {/* 結果顯示 */}
          {showResult && (
            <>
              <div className={`mb-6 p-4 rounded-2xl ${
                selectedAnswer === currentQuestion.correct 
                  ? 'bg-green-50 border-l-4 border-green-500' 
                  : 'bg-red-50 border-l-4 border-red-500'
              }`}>
                <div className="flex items-center gap-2">
                  {selectedAnswer === currentQuestion.correct ? (
                    <>
                      <CheckCircle className="w-6 h-6 text-green-600" />
                      <span className="text-green-700 font-bold">
                        🎉 答對了！獲得一面國旗！
                        {flagCount >= targetFlags && " 🏆 恭喜收集完成！"}
                      </span>
                    </>
                  ) : (
                    <>
                      <XCircle className="w-6 h-6 text-red-600" />
                      <span className="text-red-700 font-bold">
                        答錯了！正確答案是 {String.fromCharCode(65 + currentQuestion.correct)}
                      </span>
                    </>
                  )}
                </div>
              </div>
              
              {/* 答案解析 */}
              <div className="mb-6 p-4 rounded-2xl bg-blue-50 border-l-4 border-blue-400">
                <div className="flex items-start gap-3">
                  <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center font-bold text-blue-600 flex-shrink-0 mt-1">
                    💡
                  </div>
                  <div className="text-left">
                    <div className="font-semibold text-blue-700 mb-2">答案解析</div>
                    <div className="text-blue-800 leading-relaxed">
                      {currentQuestion.explanation}
                    </div>
                  </div>
                </div>
              </div>
            </>
          )}

          {/* 按鈕區 */}
          <div className="flex gap-4">
            {!showResult ? (
              <button
                onClick={handleSubmit}
                disabled={selectedAnswer === null}
                className="flex-1 bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 disabled:from-gray-300 disabled:to-gray-400 text-white font-bold py-4 px-8 rounded-2xl transition-all duration-300 transform hover:scale-105 disabled:scale-100 shadow-lg disabled:shadow-none border border-red-300"
              >
                確認答案
              </button>
            ) : (
              <button
                onClick={nextQuestion}
                className="flex-1 bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-lg border border-blue-300"
              >
                {flagCount >= targetFlags ? '查看結果' : '繼續挑戰'}
              </button>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export default TaxQuizGame