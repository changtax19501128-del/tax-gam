import React, { useState, useEffect } from 'react';
import { Trophy, Flag, CheckCircle, XCircle, RotateCcw, Sparkles, Facebook, Youtube, Instagram, Clock } from 'lucide-react';

const TaxQuizGame = () => {
  const questions = [
    {
      question: "æˆ¿å±‹ç¨…æ¯å¹´å¹¾æœˆé–‹å§‹ç¹³ç´ï¼Ÿ",
      options: ["3æœˆ", "5æœˆ", "7æœˆ", "9æœˆ"],
      correct: 1,
      explanation: "æˆ¿å±‹ç¨…æ¯å¹´5æœˆé–‹å§‹ç¹³ç´ï¼Œç¹³ç´æœŸé–“é€šå¸¸æ˜¯5æœˆ1æ—¥åˆ°5æœˆ31æ—¥ã€‚é€™æ˜¯å°ç£çš„å›ºå®šç¨…æ”¶æ™‚ç¨‹ï¼Œæˆ¿å±‹æ‰€æœ‰äººè¦è¨˜å¾—æŒ‰æ™‚ç¹³ç´å–”ï¼"
    },
    {
      question: "ç‰Œç…§ç¨…æ˜¯å°ä»€éº¼æ±è¥¿èª²ç¨…çš„ï¼Ÿ",
      options: ["æˆ¿å­", "æ±½è»Šæ©Ÿè»Š", "åœŸåœ°", "å•†åº—"],
      correct: 1,
      explanation: "ç‰Œç…§ç¨…æ˜¯é‡å°æ±½è»Šã€æ©Ÿè»Šç­‰è»Šè¼›èª²å¾µçš„ç¨…ï¼Œç›®çš„æ˜¯è¦è»Šä¸»ç‚ºä½¿ç”¨é“è·¯ä»˜è²»ã€‚æ¯å¹´éƒ½è¦ç¹³ç´ï¼Œè®“æ”¿åºœå¯ä»¥ç¶­è­·é“è·¯è¨­æ–½ã€‚"
    },
    {
      question: "é›²ç«¯ç™¼ç¥¨å¯ä»¥å¹«æˆ‘å€‘åšä»€éº¼ï¼Ÿ",
      options: ["è‡ªå‹•å°ç", "ç’°ä¿æ¸›ç´™", "è¨˜éŒ„æ¶ˆè²»", "ä»¥ä¸Šéƒ½å°"],
      correct: 3,
      explanation: "é›²ç«¯ç™¼ç¥¨çœŸçš„å¾ˆæ£’ï¼å®ƒå¯ä»¥è‡ªå‹•å¹«æˆ‘å€‘å°çï¼Œä¸ç”¨æ“”å¿ƒç™¼ç¥¨éºå¤±ï¼›æ¸›å°‘ç´™å¼µä½¿ç”¨æ›´ç’°ä¿ï¼›é‚„èƒ½è‡ªå‹•è¨˜éŒ„æˆ‘å€‘çš„æ¶ˆè²»ï¼Œä¸€èˆ‰å¤šå¾—ï¼"
    },
    {
      question: "åœ°åƒ¹ç¨…æ˜¯æ¯å¹´ä»€éº¼æ™‚å€™ç¹³ç´ï¼Ÿ",
      options: ["5æœˆ", "7æœˆ", "9æœˆ", "11æœˆ"],
      correct: 3,
      explanation: "åœ°åƒ¹ç¨…æ¯å¹´11æœˆé–‹å§‹ç¹³ç´ï¼Œé€šå¸¸ç¹³ç´æœŸé–“æ˜¯11æœˆ1æ—¥åˆ°11æœˆ30æ—¥ã€‚é€™æ˜¯é‡å°åœŸåœ°æ‰€æœ‰äººèª²å¾µçš„ç¨…ï¼ŒæŒ‰åœŸåœ°çš„å…¬å‘Šåœ°åƒ¹è¨ˆç®—ã€‚"
    },
    {
      question: "ç´ä¿å®˜æ˜¯åšä»€éº¼çš„ï¼Ÿ",
      options: ["ä¿è­·ç´ç¨…äººæ¬Šç›Š", "æ”¶ç¨…", "è³£ä¿éšª", "é–‹ç½°å–®"],
      correct: 0,
      explanation: "ç´ä¿å®˜å…¨åæ˜¯ã€Œç´ç¨…è€…æ¬Šåˆ©ä¿è­·å®˜ã€ï¼Œå°ˆé–€ä¿è­·ç´ç¨…äººçš„æ¬Šç›Šï¼å¦‚æœä½ è¦ºå¾—ç¨…å‹™æ©Ÿé—œçš„è™•åˆ†ä¸å…¬å¹³ï¼Œå¯ä»¥å‘ç´ä¿å®˜ç”³è«‹å”åŠ©ã€‚"
    },
    {
      question: "å°å½°åœ¨å½°åŒ–ç¸£æœ‰3æ£Ÿæˆ¿å­ï¼Œè«‹å•å¥¹åœ¨5æœˆæœƒæ”¶åˆ°å¹¾å¼µæˆ¿å±‹ç¨…ç¨…å–®ï¼Ÿ",
      options: ["1å¼µ", "2å¼µ", "3å¼µ", "4å¼µ"],
      correct: 2,
      explanation: "æ¯æ£Ÿæˆ¿å±‹éƒ½æœƒé–‹ç«‹ä¸€å¼µç¨…å–®ï¼Œæ‰€ä»¥å°å½°æœ‰3æ£Ÿæˆ¿å­å°±æœƒæ”¶åˆ°3å¼µæˆ¿å±‹ç¨…ç¨…å–®ã€‚æ¯å¼µç¨…å–®å°æ‡‰ä¸€æ£Ÿæˆ¿å±‹ï¼Œé€™æ¨£æ‰èƒ½æ¸…æ¥šçŸ¥é“æ¯æ£Ÿæˆ¿å±‹çš„ç¨…é¡ã€‚"
    },
    {
      question: "ä½¿ç”¨é›²ç«¯ç™¼ç¥¨çš„å¥½è™•æ˜¯ä»€éº¼ï¼Ÿ",
      options: ["å¯ä»¥çœç´™å¼µ", "ä¸æœƒå¼„ä¸Ÿç™¼ç¥¨", "è‡ªå‹•å­˜èµ·ä¾†", "ä»¥ä¸Šéƒ½å°"],
      correct: 3,
      explanation: "é›²ç«¯ç™¼ç¥¨çš„å¥½è™•è¶…å¤šï¼çœç´™å¼µæ„›åœ°çƒã€ä¸æœƒå¼„ä¸Ÿç™¼ç¥¨ã€è‡ªå‹•å„²å­˜åœ¨é›²ç«¯ã€è‡ªå‹•å°çã€é‚„èƒ½è¿½è¹¤æ¶ˆè²»è¨˜éŒ„ï¼ŒçœŸçš„å¾ˆæ–¹ä¾¿ï¼"
    },
    {
      question: "è»Šä¸»å¯å°±åŒä¸€ç¸£ï¼ˆå¸‚ï¼‰å…§å…¨éƒ¨è»Šè¼›ç”³è«‹ä½¿ç”¨ç‰Œç…§ç¨…ç¨…å–®æ­¸æˆ¶ï¼Œæ¯å¼µç¨…å–®æœ€å¤šå¯ä»¥æ­¸æˆ¶å¹¾è¼›ï¼Ÿ",
      options: ["3è¼›", "4è¼›", "5è¼›", "6è¼›"],
      correct: 2,
      explanation: "ç¾è¡Œè»Šä¸»å¦‚åä¸‹æœ‰5è¼›è»Šï¼Œæ¯å¹´é ˆæ‹¿5å¼µç¨…å–®å»ç¹³ç´ï¼Œç”³è«‹æ­¸æˆ¶å¾Œï¼Œåªé ˆæ‹¿1å¼µç¹³æ¬¾æ›¸å°±å¯å®Œæˆç¹³ç´ï¼Œæ–¹ä¾¿åˆç’°ä¿ã€‚"
    },
    {
      question: "æˆ¿å±‹ç¨…æ–°åˆ¶è‡ª113å¹´7æœˆ1æ—¥èµ·å¯¦æ–½ï¼Œå¢è¨‚è‡ªä½æˆ¿å±‹éœ€æœ¬äººã€é…å¶æˆ–ç›´ç³»è¦ªå±¬è¾¦ç«£æˆ¶ç±ç™»è¨˜ï¼Œæ‰é©ç”¨è‡ªä½ä½å®¶ç”¨å„ªæƒ ç¨…ç‡ï¼Œå°ä¸å°ï¼Ÿ",
      options: ["å°", "ä¸å°", "ä¸ç¢ºå®š", "æ²’è¦å®š"],
      correct: 0,
      explanation: "æˆ¿å±‹ç¨…æ–°åˆ¶ç¢ºå¯¦è¦å®šè‡ªä½æˆ¿å±‹éœ€è¦æœ¬äººã€é…å¶æˆ–ç›´ç³»è¦ªå±¬è¾¦ç«£æˆ¶ç±ç™»è¨˜ï¼Œæ‰èƒ½é©ç”¨è‡ªä½ä½å®¶ç”¨çš„å„ªæƒ ç¨…ç‡ã€‚é€™æ˜¯ç‚ºäº†ç¢ºä¿çœŸæ­£è‡ªä½ä½¿ç”¨ã€‚"
    },
    {
      question: "ç”³è«‹åœ°åƒ¹ç¨…è‡ªç”¨ä½å®…ç”¨åœ°å„ªæƒ ç¨…ç‡ï¼Œæ‡‰æ–¼æ¯å¹´å¹¾æœˆå¹¾æ—¥å‰æå‡ºç”³è«‹ï¼Œç•¶å¹´åº¦æ‰å¯é©ç”¨ï¼Ÿ",
      options: ["8æœˆ31æ—¥", "9æœˆ22æ—¥", "10æœˆ15æ—¥", "11æœˆ1æ—¥"],
      correct: 1,
      explanation: "ç”³è«‹åœ°åƒ¹ç¨…è‡ªç”¨ä½å®…ç”¨åœ°å„ªæƒ ç¨…ç‡ï¼Œéœ€è¦åœ¨æ¯å¹´9æœˆ22æ—¥å‰æå‡ºç”³è«‹ï¼Œç•¶å¹´åº¦æ‰å¯ä»¥é©ç”¨å„ªæƒ ç¨…ç‡ã€‚è¨˜å¾—è¦æå‰ç”³è«‹å–”ï¼"
    },
    {
      question: "æœ‰è¨­å®šä¸­ççé‡‘è‡ªå‹•åŒ¯æ¬¾çš„è¼‰å…·ï¼Œé›²ç«¯ç™¼ç¥¨ä¸­çäº†æœƒæ€éº¼æ¨£ï¼Ÿ",
      options: ["è¦è‡ªå·±å»é ˜", "æœƒè‡ªå‹•åŒ¯å…¥å¸³æˆ¶", "æœƒå¯„é€šçŸ¥å–®", "ä¸æœƒä¸­ç"],
      correct: 1,
      explanation: "é›²ç«¯ç™¼ç¥¨ä¸­çæœ€æ£’çš„åœ°æ–¹å°±æ˜¯æœƒè‡ªå‹•åŒ¯å…¥ä½ è¨­å®šçš„å¸³æˆ¶ï¼ä¸ç”¨æ“”å¿ƒå¿˜è¨˜é ˜çæˆ–ç™¼ç¥¨éæœŸï¼Œç³»çµ±æœƒè‡ªå‹•å¹«ä½ è™•ç†ï¼Œè¶…æ–¹ä¾¿çš„ï¼"
    },
    {
      question: "ç´ä¿å®˜å¯ä»¥å¹«ç´ç¨…äººåšä»€éº¼ï¼Ÿ",
      options: ["ä»£ç¹³ç¨…æ¬¾", "ç”³è«‹åˆ†æœŸç¹³ç´", "ç¶­è­·æ¬Šç›Š", "æ¸›å…ç¨…é¡"],
      correct: 2,
      explanation: "ç´ä¿å®˜ä¸»è¦æ˜¯ç¶­è­·ç´ç¨…äººçš„æ¬Šç›Šï¼Œå”åŠ©è™•ç†ç¨…å‹™çˆ­è­°ã€‚é›–ç„¶ä¸èƒ½ç›´æ¥ä»£ç¹³ç¨…æ¬¾æˆ–æ¸›å…ç¨…é¡ï¼Œä½†å¯ä»¥å”åŠ©ä½ äº†è§£æ¬Šåˆ©ã€ç”³è¨´ç¨‹åºç­‰ã€‚"
    },
    {
      question: "ä¸‹åˆ—ä½•è€…ç¬¦åˆæ€§åˆ¥å¹³ç­‰è§€å¿µï¼Ÿ",
      options: ["ç”·ç”Ÿè² è²¬å·¥ä½œ", "å¥³ç”Ÿè² è²¬å®¶äº‹", "å®¶å‹™ä¸åˆ†ç”·ç”Ÿå’Œå¥³ç”Ÿï¼Œæ‡‰è©²å…±åŒè² æ“”", "ç”·å¥³ç”Ÿæœ‰ä¸åŒåˆ†å·¥"],
      correct: 2,
      explanation: "æ€§åˆ¥å¹³ç­‰çš„è§€å¿µæ˜¯ä¸è«–ç”·ç”Ÿå¥³ç”Ÿï¼Œéƒ½æ‡‰è©²å…±åŒè² æ“”å®¶å‹™å’Œå·¥ä½œè²¬ä»»ã€‚æ¯å€‹äººéƒ½æœ‰å¹³ç­‰çš„æ¬Šåˆ©å’Œç¾©å‹™ï¼Œä¸æ‡‰è©²å› ç‚ºæ€§åˆ¥è€Œæœ‰å·®åˆ¥å¾…é‡ã€‚"
    },
    {
      question: "æˆ¿å±‹ç¨…æ–°åˆ¶è‡ª113å¹´7æœˆ1æ—¥èµ·å¯¦æ–½ï¼Œä¸¦æ”¹æŒ‰ã€Œå¹´ã€è¨ˆå¾µï¼Œä»¥æ¯å¹´å¹¾æœˆæœ«æ—¥ç‚ºç´ç¨…ç¾©å‹™åŸºæº–æ—¥ï¼Ÿ",
      options: ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ"],
      correct: 1,
      explanation: "æˆ¿å±‹ç¨…æ–°åˆ¶æ”¹æŒ‰å¹´è¨ˆå¾µå¾Œï¼Œä»¥æ¯å¹´2æœˆæœ«æ—¥ç‚ºç´ç¨…ç¾©å‹™åŸºæº–æ—¥ã€‚é€™è¡¨ç¤ºæˆ¿å±‹çš„ä½¿ç”¨æƒ…æ³å’Œç¨…ç‡é©ç”¨ï¼Œéƒ½ä»¥2æœˆåº•çš„ç‹€æ³ç‚ºæº–ã€‚"
    },
    {
      question: "å¦‚æœä½ æœ‰åœ°æ–¹ç¨…å•é¡Œï¼Œå¯å‘å“ªä¸€å€‹æ©Ÿé—œè©¢å•ï¼Ÿ",
      options: ["è­¦å¯Ÿå±€", "åœ°æ–¹ç¨…å‹™å±€", "å€å…¬æ‰€", "éƒµå±€"],
      correct: 1,
      explanation: "æœ‰åœ°æ–¹ç¨…å•é¡Œç•¶ç„¶è¦æ‰¾åœ°æ–¹ç¨…å‹™å±€ï¼ä»–å€‘æ˜¯å°ˆé–€è™•ç†æˆ¿å±‹ç¨…ã€åœ°åƒ¹ç¨…ã€ç‰Œç…§ç¨…ç­‰åœ°æ–¹ç¨…å‹™çš„å°ˆæ¥­æ©Ÿé—œï¼Œå¯ä»¥æä¾›æœ€æ­£ç¢ºçš„è³‡è¨Šå’Œæœå‹™ã€‚"
    }
  ];

  const [currentQuestions, setCurrentQuestions] = useState([]);
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [showResult, setShowResult] = useState(false);
  const [flags, setFlags] = useState([]);
  const [gameFinished, setGameFinished] = useState(false);
  const [gameStarted, setGameStarted] = useState(false);
  const [startTime, setStartTime] = useState(null);
  const [endTime, setEndTime] = useState(null);

  // éš¨æ©Ÿé¸æ“‡é¡Œç›®
  useEffect(() => {
    const shuffled = [...questions].sort(() => Math.random() - 0.5);
    setCurrentQuestions(shuffled);
  }, []);

  const currentQuestion = currentQuestions[currentQuestionIndex];
  const flagCount = flags.length;
  const targetFlags = 3;

  const handleAnswerSelect = (answerIndex) => {
    if (showResult) return;
    setSelectedAnswer(answerIndex);
  };

  const handleSubmit = () => {
    if (selectedAnswer === null) return;
    
    setShowResult(true);
    const isCorrect = selectedAnswer === currentQuestion.correct;
    
    if (isCorrect) {
      const newFlags = [...flags, { id: Date.now(), correct: true }];
      setFlags(newFlags);
      
      // å¦‚æœç²å¾—3é¢åœ‹æ——å°±çµæŸéŠæˆ²
      if (newFlags.length >= targetFlags) {
        setEndTime(Date.now());
        setTimeout(() => setGameFinished(true), 1500);
      }
    }
  };

  const nextQuestion = () => {
    if (flagCount >= targetFlags) {
      setEndTime(Date.now());
      setGameFinished(true);
      return;
    }

    if (currentQuestionIndex < currentQuestions.length - 1) {
      setCurrentQuestionIndex(currentQuestionIndex + 1);
      setSelectedAnswer(null);
      setShowResult(false);
    } else {
      setEndTime(Date.now());
      setGameFinished(true);
    }
  };

  const resetGame = () => {
    const shuffled = [...questions].sort(() => Math.random() - 0.5);
    setCurrentQuestions(shuffled);
    setCurrentQuestionIndex(0);
    setSelectedAnswer(null);
    setShowResult(false);
    setFlags([]);
    setGameFinished(false);
    setGameStarted(false);
    setStartTime(null);
    setEndTime(null);
  };

  const startGame = () => {
    setGameStarted(true);
    setStartTime(Date.now());
  };

  // è¨ˆç®—éŠæˆ²æ™‚é–“
  const getGameTime = () => {
    if (!startTime || !endTime) return "0ç§’";
    const timeDiff = Math.floor((endTime - startTime) / 1000);
    const minutes = Math.floor(timeDiff / 60);
    const seconds = timeDiff % 60;
    return minutes > 0 ? `${minutes}åˆ†${seconds}ç§’` : `${seconds}ç§’`;
  };

  if (currentQuestions.length === 0) {
    return (
      <div className="min-h-screen flex items-center justify-center" style={{
        backgroundImage: 'url("data:image/svg+xml,%3Csvg width="1242" height="828" viewBox="0 0 1242 828" fill="none" xmlns="http://www.w3.org/2000/svg"%3E%3Crect width="1242" height="828" fill="%23F5E6D3"/%3E%3Crect x="100" y="92" width="1042" height="644" rx="20" fill="%23E85A4F"/%3E%3Crect x="100" y="92" width="568" height="356" fill="%23547D8C"/%3E%3Cg transform="translate(384,270)"%3E%3Ccircle cx="0" cy="0" r="60" fill="%23F5E6D3"/%3E%3Cpath d="M0,-80 L15,-25 L0,-35 L-15,-25 Z M0,-80 L25,-15 L35,0 L25,15 Z M0,-80 L15,25 L0,35 L-15,25 Z M0,-80 L-25,15 L-35,0 L-25,-15 Z" fill="%23F5E6D3"/%3E%3Cpath d="M0,80 L-15,25 L0,35 L15,25 Z M0,80 L-25,15 L-35,0 L-25,-15 Z M0,80 L-15,-25 L0,-35 L15,-25 Z M0,80 L25,-15 L35,0 L25,15 Z" fill="%23F5E6D3"/%3E%3Cpath d="M80,0 L25,15 L35,0 L25,-15 Z M80,0 L15,25 L0,35 L-15,25 Z M80,0 L-25,15 L-35,0 L-25,-15 Z M80,0 L-15,-25 L0,-35 L15,-25 Z" fill="%23F5E6D3"/%3E%3Cpath d="M-80,0 L-25,-15 L-35,0 L-25,15 Z M-80,0 L-15,-25 L0,-35 L15,-25 Z M-80,0 L25,-15 L35,0 L25,15 Z M-80,0 L15,25 L0,35 L-15,25 Z" fill="%23F5E6D3"/%3E%3C/g%3E%3C/svg%3E")',
        backgroundSize: 'cover',
        backgroundPosition: 'center',
        backgroundRepeat: 'no-repeat'
      }}>
        <div className="text-center">
          <div className="text-2xl font-bold text-red-600 mb-4">è¼‰å…¥ä¸­...</div>
          <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-red-500 mx-auto"></div>
        </div>
      </div>
    );
  }

  // éŠæˆ²é–‹å§‹å‰çš„èªªæ˜ç•«é¢
  if (!gameStarted) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-red-50 via-white to-blue-50 flex items-center justify-center p-4">
        <div className="bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-8 max-w-2xl w-full text-center border border-red-100 relative">
          {/* æ¨™é¡Œå€ */}
          <div className="flex justify-center gap-4 mb-6">
            <Sparkles className="w-12 h-12 text-red-400 animate-pulse" />
            <Trophy className="w-16 h-16 text-red-500" />
            <Sparkles className="w-12 h-12 text-blue-400 animate-pulse" />
          </div>
          
          <h1 className="text-4xl font-bold text-red-600 mb-2">
            ğŸŠ åœ‹æ…¶ç¨…å‹™å°é”äºº ğŸŠ
          </h1>
          <p className="text-lg text-blue-600 mb-8 flex items-center justify-center gap-2">
            <Flag className="w-5 h-5" />
            æ­¡è¿ä¾†åˆ°ç¨…å‹™çŸ¥è­˜æŒ‘æˆ°ï¼
            <Sparkles className="w-5 h-5 text-yellow-400" />
          </p>
          
          {/* éŠæˆ²ç©æ³•èªªæ˜ */}
          <div className="bg-gradient-to-r from-red-50 to-blue-50 rounded-2xl p-6 mb-8 border border-red-100">
            <h2 className="text-2xl font-bold text-red-700 mb-4 flex items-center justify-center gap-2">
              <Flag className="w-6 h-6" />
              éŠæˆ²ç©æ³•
            </h2>
            
            <div className="text-left space-y-4 text-gray-700">
              <div className="flex items-start gap-3">
                <div className="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center font-bold text-red-600 flex-shrink-0 mt-1">
                  1
                </div>
                <div>
                  <div className="font-semibold text-red-700">ç­”é¡ŒæŒ‘æˆ°</div>
                  <div>å›ç­”ç¨…å‹™ç›¸é—œå•é¡Œï¼ŒåŒ…å«æˆ¿å±‹ç¨…ã€ç‰Œç…§ç¨…ã€é›²ç«¯ç™¼ç¥¨ç­‰çŸ¥è­˜</div>
                </div>
              </div>
              
              <div className="flex items-start gap-3">
                <div className="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center font-bold text-red-600 flex-shrink-0 mt-1">
                  2
                </div>
                <div>
                  <div className="font-semibold text-red-700">æ”¶é›†åœ‹æ——</div>
                  <div>æ¯ç­”å°ä¸€é¡Œå°±èƒ½ç²å¾—ä¸€é¢åœ‹æ—— ğŸš©</div>
                </div>
              </div>
              
              <div className="flex items-start gap-3">
                <div className="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center font-bold text-red-600 flex-shrink-0 mt-1">
                  3
                </div>
                <div>
                  <div className="font-semibold text-red-700">æŒ‘æˆ°ç›®æ¨™</div>
                  <div>æ”¶é›†åˆ° <span className="font-bold text-red-600">3é¢åœ‹æ——</span> å°±å®ŒæˆæŒ‘æˆ°ï¼ğŸ†</div>
                </div>
              </div>
              
              <div className="flex items-start gap-3">
                <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center font-bold text-blue-600 flex-shrink-0 mt-1">
                  ğŸ’¡
                </div>
                <div>
                  <div className="font-semibold text-blue-700">å°æç¤º</div>
                  <div>é¡Œç›®éƒ½å¾ˆç°¡å–®å–”ï¼ä»”ç´°æƒ³æƒ³æ—¥å¸¸ç”Ÿæ´»ä¸­çš„ç¨…å‹™çŸ¥è­˜</div>
                </div>
              </div>
            </div>
          </div>
          
          {/* é–‹å§‹æŒ‰éˆ• */}
          <button
            onClick={startGame}
            className="bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white font-bold py-4 px-12 rounded-full text-xl transition-all duration-300 transform hover:scale-105 shadow-lg border border-red-300 flex items-center gap-3 mx-auto"
          >
            <Flag className="w-6 h-6" />
            é–‹å§‹æŒ‘æˆ°
            <Sparkles className="w-6 h-6" />
          </button>
          
          <p className="text-sm text-gray-500 mt-4">
            æº–å‚™å¥½äº†å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·å­¸ç¿’ç¨…å‹™çŸ¥è­˜ï¼
          </p>
        </div>
      </div>
    );
  }

  if (gameFinished) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-red-50 via-white to-blue-50 flex items-center justify-center p-4 relative">
        <div className="bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-8 max-w-2xl w-full text-center border border-red-100">
          {/* ç…™ç«æ•ˆæœ */}
          <div className="flex justify-center gap-4 mb-6">
            <Sparkles className="w-12 h-12 text-red-400 animate-pulse" />
            <Trophy className="w-16 h-16 text-red-500" />
            <Sparkles className="w-12 h-12 text-blue-400 animate-pulse" />
          </div>
          
          <h1 className="text-4xl font-bold text-red-600 mb-4">
            ğŸ‰ æ­å–œå®ŒæˆæŒ‘æˆ°ï¼ğŸ‰
          </h1>
          
          {/* é€šé—œæ™‚é–“é¡¯ç¤º */}
          <div className="mb-4 bg-gradient-to-r from-yellow-100 to-yellow-200 rounded-2xl p-4 border border-yellow-300">
            <div className="flex items-center justify-center gap-2 text-yellow-800">
              <Clock className="w-5 h-5" />
              <span className="font-bold text-lg">é€šé—œæ™‚é–“: {getGameTime()}</span>
            </div>
          </div>
          
          {flagCount >= targetFlags ? (
            <div className="mb-6">
              <h3 className="text-2xl font-semibold text-red-700 mb-3">ğŸ† æŒ‘æˆ°æˆåŠŸï¼</h3>
              <p className="text-lg text-gray-700">ä½ å·²ç¶“æ”¶é›†åˆ° {targetFlags} é¢åœ‹æ——äº†ï¼</p>
            </div>
          ) : (
            <div className="mb-6">
              <h3 className="text-xl font-semibold text-blue-600 mb-3">ç¹¼çºŒåŠ æ²¹ï¼</h3>
              <p className="text-lg text-gray-700">ä½ æ”¶é›†åˆ°äº† {flagCount} é¢åœ‹æ——</p>
            </div>
          )}
          
          {/* é¡¯ç¤ºç²å¾—çš„åœ‹æ—— */}
          <div className="mb-8">
            <div className="flex justify-center gap-3 mb-4">
              {Array.from({ length: targetFlags }).map((_, index) => (
                <div key={index} className="relative">
                  <Flag 
                    className={`w-12 h-12 ${
                      index < flagCount ? 'text-red-500' : 'text-gray-300'
                    }`} 
                  />
                  {index < flagCount && (
                    <Sparkles className="w-4 h-4 text-yellow-400 absolute -top-1 -right-1 animate-bounce" />
                  )}
                </div>
              ))}
            </div>
            <div className="text-lg font-bold text-red-600">
              åœ‹æ——æ”¶é›†é€²åº¦: {flagCount}/{targetFlags}
            </div>
          </div>
          
          <button
            onClick={resetGame}
            className="bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white font-bold py-3 px-8 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center gap-2 mx-auto border border-red-300"
          >
            <RotateCcw className="w-5 h-5" />
            å†ç©ä¸€æ¬¡
          </button>
          
          {/* å…Œæ›ç‹€æ…‹é¡¯ç¤º */}
          {isRedeemed && (
            <div className="mt-6 bg-green-100 border border-green-400 rounded-2xl p-4">
              <div className="flex items-center justify-center gap-2 text-green-700">
                <CheckCircle className="w-6 h-6" />
                <span className="font-bold text-lg">âœ… å·²å…Œæ›çå“</span>
              </div>
            </div>
          )}
          
          {/* å·¥ä½œäººå“¡è¼¸å…¥å€ */}
          {!isRedeemed && (
            <div className="mt-6 text-center">
              {!showStaffInput ? (
                <>
                  <button
                    onClick={() => setShowStaffInput(true)}
                    className="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-6 rounded-lg transition-colors duration-200"
                  >
                    çå“å…Œæ›
                  </button>
                  <p className="text-xs text-gray-500 mt-2">å·¥ä½œäººå“¡è¼¸å…¥</p>
                </>
              ) : (
                <div className="bg-gray-50 rounded-2xl p-4 border border-gray-200">
                  <input
                    type="password"
                    value={staffCode}
                    onChange={(e) => setStaffCode(e.target.value)}
                    placeholder="è«‹è¼¸å…¥é©—è­‰ç¢¼"
                    className="w-32 p-2 border border-gray-300 rounded-lg text-center font-mono"
                    maxLength="3"
                  />
                  <div className="flex gap-2 justify-center mt-3">
                    <button
                      onClick={handleStaffInput}
                      className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium"
                    >
                      ç¢ºèª
                    </button>
                    <button
                      onClick={() => {
                        setShowStaffInput(false);
                        setStaffCode('');
                      }}
                      className="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg font-medium"
                    >
                      å–æ¶ˆ
                    </button>
                  </div>
                </div>
              )}
            </div>
          )}
          
          {/* FBã€IGã€YT é€£çµ - å³ä¸‹è§’ */}
          <div className="absolute bottom-6 right-6 flex flex-col gap-2">
            <a 
              href="https://www.facebook.com/ChangTax" 
              target="_blank" 
              rel="noopener noreferrer"
              className="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 group"
              title="Facebook ç²‰çµ²åœ˜"
            >
              <Facebook className="w-5 h-5" />
            </a>
            <a 
              href="https://www.youtube.com/channel/UCyixdD80Dk9LsjB2pr5aHtg" 
              target="_blank" 
              rel="noopener noreferrer"
              className="bg-red-600 hover:bg-red-700 text-white p-2 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 group"
              title="YouTube é »é“"
            >
              <Youtube className="w-5 h-5" />
            </a>
            <a 
              href="https://www.instagram.com/changtax_/" 
              target="_blank" 
              rel="noopener noreferrer"
              className="bg-pink-600 hover:bg-pink-700 text-white p-2 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110 group"
              title="Instagram"
            >
              <Instagram className="w-5 h-5" />
            </a>
          </div>
        </div>
        
        {/* å·¦ä¸‹è§’ç½²å - åªåœ¨é€šé—œæ™‚é¡¯ç¤º */}
        <div className="absolute bottom-6 left-6 text-black font-bold text-lg">
          å½°åŒ–ç¸£åœ°æ–¹ç¨…å‹™å±€
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen p-4" style={{
      backgroundImage: 'url("data:image/svg+xml,%3Csvg width="1242" height="828" viewBox="0 0 1242 828" fill="none" xmlns="http://www.w3.org/2000/svg"%3E%3Crect width="1242" height="828" fill="%23F5E6D3"/%3E%3Crect x="100" y="92" width="1042" height="644" rx="20" fill="%23E85A4F"/%3E%3Crect x="100" y="92" width="568" height="356" fill="%23547D8C"/%3E%3Cg transform="translate(384,270)"%3E%3Ccircle cx="0" cy="0" r="60" fill="%23F5E6D3"/%3E%3Cpath d="M0,-80 L15,-25 L0,-35 L-15,-25 Z M0,-80 L25,-15 L35,0 L25,15 Z M0,-80 L15,25 L0,35 L-15,25 Z M0,-80 L-25,15 L-35,0 L-25,-15 Z" fill="%23F5E6D3"/%3E%3Cpath d="M0,80 L-15,25 L0,35 L15,25 Z M0,80 L-25,15 L-35,0 L-25,-15 Z M0,80 L-15,-25 L0,-35 L15,-25 Z M0,80 L25,-15 L35,0 L25,15 Z" fill="%23F5E6D3"/%3E%3Cpath d="M80,0 L25,15 L35,0 L25,-15 Z M80,0 L15,25 L0,35 L-15,25 Z M80,0 L-25,15 L-35,0 L-25,-15 Z M80,0 L-15,-25 L0,-35 L15,-25 Z" fill="%23F5E6D3"/%3E%3Cpath d="M-80,0 L-25,-15 L-35,0 L-25,15 Z M-80,0 L-15,-25 L0,-35 L15,-25 Z M-80,0 L25,-15 L35,0 L25,15 Z M-80,0 L15,25 L0,35 L-15,25 Z" fill="%23F5E6D3"/%3E%3C/g%3E%3C/svg%3E")',
      backgroundSize: 'cover',
      backgroundPosition: 'center',
      backgroundRepeat: 'no-repeat'
    }}>
      <div className="max-w-4xl mx-auto relative">
        {/* æ¨™é¡Œèˆ‡çµ±è¨ˆè³‡è¨Š */}
        <div className="bg-white/90 backdrop-blur-sm rounded-3xl shadow-xl p-6 mb-6 border border-red-100">
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-3">
              <Trophy className="w-8 h-8 text-red-500" />
              <h1 className="text-3xl font-bold text-red-600">
                ğŸŠ åœ‹æ…¶ç¨…å‹™å°é”äºº ğŸŠ
              </h1>
            </div>
            
            {/* å³ä¸Šè§’åœ‹æ——çµ±è¨ˆ */}
            <div className="text-right">
              <div className="text-lg font-bold text-red-600 mb-2">
                åœ‹æ——æ”¶é›†é€²åº¦: {flagCount}/{targetFlags}
              </div>
              <div className="flex gap-1">
                {Array.from({ length: targetFlags }).map((_, index) => (
                  <Flag 
                    key={index}
                    className={`w-6 h-6 ${
                      index < flagCount ? 'text-red-500' : 'text-gray-300'
                    }`} 
                  />
                ))}
              </div>
            </div>
          </div>
        </div>

        {/* é¡Œç›®å¡ç‰‡ */}
        <div className="bg-white/90 backdrop-blur-sm rounded-3xl shadow-xl p-8 border border-blue-100">
          <div className="mb-6">
            <div className="text-sm text-blue-600 mb-2 flex items-center gap-2">
              <Sparkles className="w-4 h-4" />
              ç¬¬ {currentQuestionIndex + 1} é¡Œ
            </div>
            <div className="w-full bg-blue-100 rounded-full h-3">
              <div 
                className="bg-gradient-to-r from-red-400 to-blue-400 h-3 rounded-full transition-all duration-500"
                style={{ width: `${((currentQuestionIndex + 1) / currentQuestions.length) * 100}%` }}
              ></div>
            </div>
          </div>

          <h2 className="text-2xl font-bold text-red-700 mb-8">
            {currentQuestion?.question}
          </h2>

          <div className="space-y-4 mb-8">
            {currentQuestion?.options.map((option, index) => {
              let buttonClass = "w-full p-4 rounded-2xl border-2 transition-all duration-300 text-left font-medium";
              
              if (showResult) {
                if (index === currentQuestion.correct) {
                  buttonClass += " bg-green-50 border-green-400 text-green-700";
                } else if (index === selectedAnswer && index !== currentQuestion.correct) {
                  buttonClass += " bg-red-50 border-red-400 text-red-700";
                } else {
                  buttonClass += " bg-gray-50 border-gray-300 text-gray-600";
                }
              } else {
                if (selectedAnswer === index) {
                  buttonClass += " bg-red-50 border-red-400 text-red-700";
                } else {
                  buttonClass += " bg-white border-blue-200 text-blue-800 hover:bg-blue-50 hover:border-blue-300 cursor-pointer";
                }
              }

              return (
                <button
                  key={index}
                  onClick={() => handleAnswerSelect(index)}
                  className={buttonClass}
                >
                  <div className="flex items-center gap-3">
                    <div className="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center font-bold text-red-700">
                      {String.fromCharCode(65 + index)}
                    </div>
                    {option}
                    {showResult && index === currentQuestion.correct && (
                      <CheckCircle className="w-6 h-6 text-green-600 ml-auto" />
                    )}
                    {showResult && index === selectedAnswer && index !== currentQuestion.correct && (
                      <XCircle className="w-6 h-6 text-red-600 ml-auto" />
                    )}
                  </div>
                </button>
              );
            })}
          </div>

          {/* çµæœé¡¯ç¤º */}
          {showResult && (
            <>
              <div className={`mb-6 p-4 rounded-2xl ${
                selectedAnswer === currentQuestion.correct 
                  ? 'bg-green-50 border-l-4 border-green-500' 
                  : 'bg-red-50 border-l-4 border-red-500'
              }`}>
                <div className="flex items-center gap-2">
                  {selectedAnswer === currentQuestion.correct ? (
                    <>
                      <CheckCircle className="w-6 h-6 text-green-600" />
                      <span className="text-green-700 font-bold">
                        ğŸ‰ ç­”å°äº†ï¼ç²å¾—ä¸€é¢åœ‹æ——ï¼
                        {flagCount >= targetFlags && " ğŸ† æ­å–œæ”¶é›†å®Œæˆï¼"}
                      </span>
                    </>
                  ) : (
                    <>
                      <XCircle className="w-6 h-6 text-red-600" />
                      <span className="text-red-700 font-bold">
                        ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ {String.fromCharCode(65 + currentQuestion.correct)}
                      </span>
                    </>
                  )}
                </div>
              </div>
              
              {/* ç­”æ¡ˆè§£æ */}
              <div className="mb-6 p-4 rounded-2xl bg-blue-50 border-l-4 border-blue-400">
                <div className="flex items-start gap-3">
                  <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center font-bold text-blue-600 flex-shrink-0 mt-1">
                    ğŸ’¡
                  </div>
                  <div className="text-left">
                    <div className="font-semibold text-blue-700 mb-2">ç­”æ¡ˆè§£æ</div>
                    <div className="text-blue-800 leading-relaxed">
                      {currentQuestion.explanation}
                    </div>
                  </div>
                </div>
              </div>
            </>
          )}

          {/* æŒ‰éˆ•å€ */}
          <div className="flex gap-4">
            {!showResult ? (
              <button
                onClick={handleSubmit}
                disabled={selectedAnswer === null}
                className="flex-1 bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 disabled:from-gray-300 disabled:to-gray-400 text-white font-bold py-4 px-8 rounded-2xl transition-all duration-300 transform hover:scale-105 disabled:scale-100 shadow-lg disabled:shadow-none border border-red-300"
              >
                ç¢ºèªç­”æ¡ˆ
              </button>
            ) : (
              <button
                onClick={nextQuestion}
                className="flex-1 bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-lg border border-blue-300"
              >
                {flagCount >= targetFlags ? 'æŸ¥çœ‹çµæœ' : 'ç¹¼çºŒæŒ‘æˆ°'}
              </button>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export default TaxQuizGame