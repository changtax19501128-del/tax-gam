<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ç§Ÿç¨…é¦¬æ‹‰æ¾å°éŠæˆ²</title>
  <style>
    body { margin:0; background:#f0f0f0; font-family:Arial; }
    canvas { display:block; margin:0 auto; background:#000; }
    #quizBox, #passScreen {
      position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%);
      background: white; padding: 20px; border: 2px solid #333; display: none;
    }
    #quizBox button { margin-top: 10px; }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="400"></canvas>
  
  <div id="quizBox">
    <div id="question"></div>
    <input type="text" id="answer" placeholder="è¼¸å…¥ç­”æ¡ˆ..." />
    <button onclick="checkAnswer()">é€å‡º</button>
  </div>
  
  <div id="passScreen">
    <h2>æ­å–œç­”å°ä¸‰é¡Œï¼</h2>
    <p>è«‹å·¥ä½œäººå“¡è¼¸å…¥é€šè¡Œç¢¼ï¼š</p>
    <input type="password" id="passcode" placeholder="è¼¸å…¥é€šè¡Œç¢¼" />
    <button onclick="checkPasscode()">ç¢ºèª</button>
    <p id="passMessage"></p>
  </div>
  
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// ç©å®¶ç‰©ä»¶
let player = { x:50, y:180, w:50, h:50 };
let keys = {};
let obstacles = [];
let frame = 0;
let score = 0;

let questions = [
  { q:"è«‹å•ä½¿ç”¨é›²ç«¯ç™¼ç¥¨æœ‰ä»€éº¼å¥½è™•ï¼Ÿ(è¼¸å…¥:æ–¹ä¾¿)", a:"æ–¹ä¾¿" },
  { q:"åœ°åƒ¹ç¨…è‡ªç”¨ä½å®…ç”¨åœ°ç¨…ç‡æ˜¯å¦è¼ƒä½ï¼Ÿ(è¼¸å…¥:æ˜¯)", a:"æ˜¯" },
  { q:"è«‹å•ç§Ÿç¨…å®£å°çš„ç›®çš„ï¼Ÿ(è¼¸å…¥:å®£å°)", a:"å®£å°" }
];

let currentQuestion = null;

document.addEventListener("keydown", e=>{ keys[e.key]=true; });
document.addEventListener("keyup", e=>{ keys[e.key]=false; });

function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ç©å®¶ç§»å‹•
  if(keys["ArrowUp"] && player.y>0) player.y -=3;
  if(keys["ArrowDown"] && player.y<canvas.height-player.h) player.y +=3;
  
  // ç•«ç©å®¶
  ctx.fillStyle="blue";
  ctx.fillRect(player.x, player.y, player.w, player.h);
  
  // ç”Ÿæˆç´ æ
  frame++;
  if(frame % 120 ===0){
    obstacles.push({ x:canvas.width, y:Math.random()*350, r:20 });
  }
  
  // ç•«ç´ æ
  ctx.fillStyle="red";
  for(let i=obstacles.length-1; i>=0; i--){
    let o=obstacles[i];
    o.x-=3;
    ctx.beginPath();
    ctx.arc(o.x, o.y, o.r, 0, Math.PI*2);
    ctx.fill();
    
    // ç¢°æ’åˆ¤å®š
    if(player.x < o.x+o.r && player.x+player.w > o.x-o.r &&
       player.y < o.y+o.r && player.y+player.h > o.y-o.r){
        obstacles.splice(i,1);
        showQuestion();
    }
    
    if(o.x<-20) obstacles.splice(i,1);
  }
  
  requestAnimationFrame(gameLoop);
}

function showQuestion(){
  if(score>=3) return; 
  currentQuestion = questions[Math.floor(Math.random()*questions.length)];
  document.getElementById("question").innerText = currentQuestion.q;
  document.getElementById("quizBox").style.display="block";
}

function checkAnswer(){
  let ans = document.getElementById("answer").value.trim();
  if(ans===currentQuestion.a){
    alert("ç­”å°äº†ï¼");
    score++;
    if(score>=3){
      document.getElementById("quizBox").style.display="none";
      document.getElementById("passScreen").style.display="block";
      return;
    }
  } else {
    alert("ç­”éŒ¯äº†ï¼Œå†è©¦ä¸€æ¬¡ï¼");
  }
  document.getElementById("answer").value="";
  document.getElementById("quizBox").style.display="none";
}

function checkPasscode(){
  let code = document.getElementById("passcode").value;
  if(code==="1234"){
    document.getElementById("passMessage").innerText="âœ… æ­å–œå®ŒæˆéŠæˆ²ï¼";
    sendToGoogleSheet(); // ğŸ¯ æˆåŠŸå¾Œé€è³‡æ–™
  } else {
    document.getElementById("passMessage").innerText="âŒ é€šè¡Œç¢¼éŒ¯èª¤ï¼";
  }
}

// âœ… æŠŠå®Œæˆç´€éŒ„é€åˆ° Google è©¦ç®—è¡¨
function sendToGoogleSheet(){
  fetch("https://script.google.com/macros/s/AKfycbzdh9WwBy5GpEp6t_EzsQ1GIFKhAuwQ8nIMnfUlquwbyd1cSlhpXH8VjEvWElFPeqA/exec", {
      method: "POST",
      body: JSON.stringify({
          player: "Player_" + Date.now()
      })
  })
  .then(res => res.text())
  .then(txt => console.log("âœ… å·²é€å‡ºè³‡æ–™ï¼š" + txt))
  .catch(err => console.error("âŒ ä¸Šå‚³å¤±æ•—", err));
}

gameLoop();
</script>
</body>
</html>
